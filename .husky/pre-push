#!/bin/sh

echo "ğŸš€ Running pre-push checks..."

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo "âŒ Must be run from project root"
    exit 1
fi

# Frontend checks
echo "ğŸ“¦ Frontend: Running type check..."
cd frontend
if ! npm run typecheck; then
    echo "âŒ Frontend type check failed"
    exit 1
fi

echo "ğŸ” Frontend: Running linter..."
if ! npm run lint; then
    echo "âŒ Frontend linting failed"
    exit 1
fi

echo "ğŸ§ª Frontend: Running tests..."
if ! npm test -- --watch=false --browsers=ChromeHeadless; then
    echo "âŒ Frontend tests failed"
    exit 1
fi

cd ..

# Backend checks
echo "ğŸ¦€ Backend: Running format check..."
cd backend
if ! cargo fmt --check; then
    echo "âŒ Backend format check failed. Run 'cargo fmt' to fix."
    exit 1
fi

echo "ğŸ“‹ Backend: Running clippy..."
if ! cargo clippy -- -D warnings; then
    echo "âŒ Backend clippy check failed"
    exit 1
fi

echo "ğŸ§ª Backend: Running tests..."
if ! cargo test; then
    echo "âŒ Backend tests failed"
    exit 1
fi

echo "âœ… All pre-push checks passed!"